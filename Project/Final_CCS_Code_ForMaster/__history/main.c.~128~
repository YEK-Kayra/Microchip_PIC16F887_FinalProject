//Ister bisiklet ol ister tir, ne olursan ol yine gel

#include <16f887.h>

/********************************************************/
/*               SYSTEM USES                            */
/********************************************************/
#use delay(clock=4M) 
#use rs232(baud=9600,parity=N,uart1,bits=8)
#use fast_io(b)

/********************************************************/
/*               SYSTEM INCLUDES                        */
/********************************************************/
#include <lcd.c>    
      
                                        
/********************************************************/
/*               SYSTEM FUSES                           */
/********************************************************/                                         
#fuses HS,NOWDT,NOPUT,NOLVP,NOCPD,NOPROTECT,NODEBUG,NOBROWNOUT,NOWRT


/********************************************************/
/*               SYSTEM VARIABLES                       */
/********************************************************/
char readed_ID;   //Coming data will be When came from slave PIC
int8 systemLock;  //If the ID is valid, system open. Otherwise it will remain locked
int8 OPS_Status;  //55 means ops will be canceled, otherwise ops will be going on

/********************************************************/
/*               SYSTEM DEFINATION                      */
/********************************************************/
/* ======== SYSTEM INPUT & OUTPUT ======== */
#define button_NEXT           pin_A3
#define button_BACK           pin_A4
#define button_Select         pin_A5
#define button_RemoveSelect   pin_C0
#define button_OPS_START      pin_C1
#define button_OPS_CANCEL     pin_B0


/********************************************************/
/*               FUNCTIONS PROTOTYPES                   */
/********************************************************/
/* ======== SYSTEM CONFIGURATION FUNCTIONS PROTOTYPES  ======== */
void SubSystem_Init(void);
/* ======== LCD SCREEN FUNCTIONS PROTOTYPES  ======== */
void SubSystem_lcd_IdleStatus(void);
/* ======== UART SERIAL COM. FUNCTIONS PROTOTYPES  ======== */
void SubSystem_uart_CheckTheMessage(void);


/********************************************************/
/*               SYSTEM INTERRUPTS                      */
/********************************************************/
#int_EXT
void system_isr_OperationCANCEL(){
  OPS_Status = 55;
}


void main(void) 
{
  
   //-->System parameters will be initialized
   SubSystem_Init();
   
   
   //-->Wait until unlock the system
//!   do{
//!     SubSystem_lcd_IdleStatus();   //Greeting the customer
//!     if(kbhit())
//!     {
//!        readed_ID = getc();
//!        SubSystem_uart_CheckTheMessage();
//!     }      
//!  }while(systemLock!=1);
  
  
      //Potansiyometreden deðerler okuyacak, opsiyonlarý gezmek için
      //ileri butonuna basýlýnca pot hangi opsiyonda ise o opsiyona gidilecek
      //geri butonuna basýlýnca pot ile tekrardan yukardan aþaðý gezilebilecek
      
         //diyelim ki bir opsiyonun içine girdi, pot kullanarak zamanlama ayarlarý ile oynuyor, 
         //çift týk ile ilgili zaman ve ücreti seçebilecek, tek týk ile de bozabilecek
      do{
      
      
      
      }while(OPS_Status!=55);
          
    while(1)
    {
    
    // pot ilk iki kademede 
    lcd_gotoxy(1,1);
    printf(lcd_putc,"1-Kopuk Islem");
    lcd_gotoxy(1,12);
    printf(lcd_putc,"<-");
    lcd_gotoxy(1,2);
    printf(lcd_putc,"2-Su Islem");
    delay_ms(2000);
    printf(lcd_putc,"\f");
    // pot ucuncu dorduncu kademede 
    lcd_gotoxy(1,1);
    printf(lcd_putc,"3-Hava Islem");
    lcd_gotoxy(1,2);
    printf(lcd_putc,"4-Cila Islem");
    delay_ms(2000);
    printf(lcd_putc,"\f");
    // pot son kademede
    lcd_gotoxy(1,1);
    printf(lcd_putc,"5-Gecmisim");
    delay_ms(2000);
    printf(lcd_putc,"\f");   
    }
 
 
}


/* ======== SYSTEM CONFIGURATION FUNCTIONS ======== */
void SubSystem_Init(void){
 lcd_init();
}




/* ======== LCD SCREEN FUNCTIONS ======== */
void SubSystem_lcd_IdleStatus(void){
      lcd_gotoxy(4,1);
      printf(lcd_putc,"Mikroleum'a");
      lcd_gotoxy(4,2);
      printf(lcd_putc,"Hosgeldiniz");
      delay_ms(500);
      printf(lcd_putc,"\f");
      lcd_gotoxy(4,1);
      printf(lcd_putc,"Lutfen ID Karti");
      lcd_gotoxy(4,2);
      printf(lcd_putc,"Gosteriniz");
      delay_ms(500);
      printf(lcd_putc,"\f");
}


/* ======== UART PROTOCOL FUNCTIONS ======== */
void SubSystem_uart_CheckTheMessage(void){
   
   if(readed_ID == '+'){      //Mr. Selçuk's ID
   
      lcd_gotoxy(4,1);
      printf(lcd_putc,"Hosgeldiniz");
      lcd_gotoxy(4,2);
      printf(lcd_putc,"Selcuk Bey");
      systemLock = 1;
   }
   else if(readed_ID == '*'){ //Mr. Emre's ID
   
      lcd_gotoxy(4,1);
      printf(lcd_putc,"Hosgeldiniz");
      lcd_gotoxy(4,2);
      printf(lcd_putc,"Emre Bey");
      systemLock = 1;
   }
   else if(readed_ID == '.'){ //Slave pic is idle status
   
       systemLock = 0;
   }

}
